<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="seqyuan" />
        <meta name="copyright" content="seqyuan" />

<meta name="keywords" content="multi jump, multi jump, " />
        <title>造轮子上传到PYPI  · seqyuan
</title>
        <link href="http://cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/theme/css/style.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/solarizedlight.css" media="screen">
        <link rel="shortcut icon" href="/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon.png" />
        <link rel="apple-touch-icon" sizes="57x57" href="/theme/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="/theme/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="/theme/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="/theme/images/apple-touch-icon-144x144.png" />
        <link rel="icon" href="/theme/images/apple-touch-icon-144x144.png" />
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="/"><span class=site-name>seqyuan</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="">Home</a></li>
                            <li ><a href="/categories.html">Categories</a></li>
                            <li ><a href="/tags.html">Tags</a></li>
                            <li ><a href="/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href="/multiJump.html"> 造轮子上传到PYPI  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            <blockquote>
<p>我们经常以pip install package的形式安装python包，很多新同鞋有这样的疑问：怎样编写python包（自己造轮子）分享给别人，让别人也可以用pip的形式进行安装使用呢？</p>
</blockquote>
<p>要解决这个问题我们要从两方面入手：</p>
<ul>
<li>写一个python包</li>
<li>规范包的内容上传到PYPI</li>
</ul>
<h2>编写一个python包</h2>
<p>为了言之有物我们决定编写一个能解决实际应用的包：</p>
<blockquote>
<p>很多时候我们使用linux集群为了安全考虑在登录节点和计算节点不能连接互联网，只能由某个计算节点切换到跳转节点，在跳转节点才能访问互联网。为了使这种连续跳转节点执行命令的操作更加简洁容易，我们决定编写一个叫multiJump的包。</p>
</blockquote>
<p>首先我们编写好单独的脚本https://github.com/seqyuan/multiJump/blob/master/multiJump/multiJump.py</p>
<p>其实我们要把multiJump.py作为一个模块供其他程序例如sendmail.py使用，只需要把multiJump.py放在sendmail.py相同的目录下，然后在sendmail.py写下<code>import multiJump</code>就能使用multiJump.py里的类或者函数。</p>
<p>要使multiJump作为一个包存在，我们还需要搭配一定的目录结构，<strong>init</strong>.py可以是个空文件：</p>
<div class="highlight"><pre>.
|————multiJump
|    |___ __init__.py
|    |___ multiJump.py
</pre></div>


<h2>规范包的内容上传到PYPI</h2>
<p>详细的规范请见官方网页https://docs.python.org/2/distutils/setupscript.html，要符合上传到PYPI的规范，我们还需要对前面构建的multiJump目录结构再做一些调整。</p>
<div class="highlight"><pre>.
|————multiJump
|    |___ __init__.py
|    |___ multiJump.py
|————COPYING.txt
|————README.rst
|————setup.py
</pre></div>


<p>我们可以看到新的目录结构多了3个文件：</p>
<ul>
<li><strong>COPYING.txt</strong>    就是授权文件，里面是你关于这个包的授权，比如：MIT license，那么你里面放入MIT License全文即可，这个License获得方式可以在PYPI上搜一个你记得名字的包，把它的COPYING.txt直接copy过来就行。当然，如果你不清楚这个License是什么意思，你完全可以不要这个文件。</li>
<li><strong>README.rst</strong>     对于包的说明文件，推荐用rst格式编写（因为不支持markdown）</li>
<li><strong>setup.py</strong>       核心文件</li>
</ul>
<blockquote>
<p>你需要在官网注册一个PYPI账号https://pypi.org/account/register/
创建用户验证文件 ~/.pypirc</p>
</blockquote>
<div class="highlight"><pre><span class="k">[distutils]</span>
<span class="na">index-servers</span><span class="o">=</span><span class="s">pypi</span>

<span class="k">[pypi]</span>
<span class="na">repository</span> <span class="o">=</span> <span class="s">https://upload.pypi.org/legacy/</span>
<span class="na">username</span> <span class="o">=</span> <span class="s">&lt;username&gt; #在PYPI注册的账号</span>
<span class="na">password</span> <span class="o">=</span> <span class="s">&lt;password&gt; #在PYPI注册账号的密码</span>
</pre></div>


<p>来看看setup.py是怎么写的：</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">codecs</span>  
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">setup</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="n">fname</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    定义一个read方法，用来读取目录下的文件内容,作为包的描述信息</span>
<span class="sd">    我们一般是将README文件中的内容读取出来作为长描述，这个会在PyPI中你这个包的页面上展现出来，</span>
<span class="sd">    PyPI上支持.rst格式的文件，PyPI会自动把它转为HTML形式显示在你包的信息页面上</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&quot;multiJump&quot;</span><span class="p">,</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s">&quot;0.0.6&quot;</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s">&quot;seqyuan&quot;</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s">&#39;seqyuan@gmail.com&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="s">&quot;https://github.com/seqyuan/multiJump/wiki&quot;</span><span class="p">,</span>
    <span class="c">#我在github上建了wiki作为包的使用说明，你也可以根据自己需要填写其他网址</span>
    <span class="n">download_url</span> <span class="o">=</span> <span class="s">&quot;https://codeload.github.com/seqyuan/multiJump/zip/master&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s">&quot;multiple Jump IP do something&quot;</span><span class="p">,</span>
    <span class="n">long_description</span><span class="o">=</span><span class="n">read</span><span class="p">(</span><span class="s">&quot;README.rst&quot;</span><span class="p">),</span>   <span class="c">#读取README.rst里的内容作为包的详细说明</span>
    <span class="n">license</span><span class="o">=</span><span class="s">&quot;MIT&quot;</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;multiJump&#39;</span><span class="p">],</span>

    <span class="c">#执行此包必须要依赖的其他包</span>
    <span class="n">extras_require</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;sys&#39;</span> <span class="p">:</span> <span class="p">[</span> <span class="s">&#39;sys&#39;</span><span class="p">],</span>
        <span class="s">&#39;paramiko&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;paramiko&#39;</span><span class="p">],</span>
        <span class="s">&#39;socket&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;socket&#39;</span><span class="p">],</span>
        <span class="s">&#39;time&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>


<p>setup里各参数的详细说明：</p>
<table>
<thead>
<tr>
<th>Meta-Data</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>name of the package</td>
</tr>
<tr>
<td>version</td>
<td>version of this release</td>
</tr>
<tr>
<td>author</td>
<td>package author’s name</td>
</tr>
<tr>
<td>author_email</td>
<td>email address of the package author</td>
</tr>
<tr>
<td>maintainer</td>
<td>package maintainer’s name</td>
</tr>
<tr>
<td>maintainer_email</td>
<td>email address of the package maintainer</td>
</tr>
<tr>
<td>url</td>
<td>home page for the package</td>
</tr>
<tr>
<td>description</td>
<td>short, summary description of the package</td>
</tr>
<tr>
<td>long_description</td>
<td>longer description of the package</td>
</tr>
<tr>
<td>download_url</td>
<td>location where the package may be downloaded</td>
</tr>
<tr>
<td>classifiers</td>
<td>a list of classifiers</td>
</tr>
<tr>
<td>platforms</td>
<td>a list of platforms</td>
</tr>
<tr>
<td>license</td>
<td>license for the package</td>
</tr>
</tbody>
</table>
<h4>上传并完成发布</h4>
<p>上传命令<code>python3 setup.py sdist upload</code></p>
<h3>上传结果</h3>
<p>https://pypi.org/project/multiJump/
欢迎下载并使用<code>multiJump</code>
上传到PYPI之后就能用<code>pip3 install multiJump</code>安装到自己的python库了
multiJump包的使用方法可参见https://github.com/seqyuan/multiJump/wiki
我用它做的第一件应用是跳转到end节点发送邮件。</p>
            <aside>
            <hr/>
            <nav>
            <ul class="articles_timeline">
 
                <li class="previous_article">« <a href="/How to Predict Seq Data about Hi-C.html" title="Previous: 怎样预测Hi-C测序数据量">怎样预测Hi-C测序数据量</a></li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
 
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2018-05-04T00:00:00+08:00">5月 4, 2018</time>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#multi-jump-ref">multi jump</a> 
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article"> 
                <li><a href="/tags.html#multi-jump-ref">multi jump
                    <span>1</span>
</a></li>
            </ul>

        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    </body>
</html>